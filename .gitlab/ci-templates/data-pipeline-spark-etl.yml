# ~~ Generated by projen. To modify, edit .projenrc.js and run "npx projen".

stages:
  - build
etl-unit-test:
  stage: build
  image:
    name: public.ecr.aws/docker/library/gradle:7.6-jdk11
  variables: {}
  rules:
    - if: $CI_MERGE_REQUEST_IID
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
  before_script:
    - cd ./src/data-pipeline/spark-etl
    - sed -i "s/projectVersion=.*/projectVersion=1.0.0/" gradle.properties
  script:
    - gradle clean build
    - gradle jacocoAggregatedReport
  artifacts:
    reports:
      junit: ./src/data-pipeline/spark-etl/build/test-results/test/TEST-*.xml
      coverage_report:
        coverage_format: cobertura
        path: ./src/data-pipeline/spark-etl/build/reports/jacoco/jacocoAggregatedReport/jacocoAggregatedReport.xml
